"use strict";var curBooks_read=0;var curBooks_reading=0;var curBooks_wish=0;var curMovies=0;DoubanBoard={initDoubanBoard:function o(){$('.douban-book-list[data-status="read"]').after('<div class="douban-loadmore" id="loadMoreBooks_read" onclick="DoubanBoard.loadBooks(\'read\');">加载更多</div>');$('.douban-book-list[data-status="reading"]').after('<div class="douban-loadmore" id="loadMoreBooks_reading" onclick="DoubanBoard.loadBooks(\'reading\');">加载更多</div>');$('.douban-book-list[data-status="wish"]').after('<div class="douban-loadmore" id="loadMoreBooks_wish" onclick="DoubanBoard.loadBooks(\'wish\');">加载更多</div>');$("#douban-movie-list").after('<div class="douban-loadmore" id="loadMoreMovies" onclick="DoubanBoard.loadMovies();">加载更多</div>');curBooks_read=0;curBooks_reading=0;curBooks_wish=0;DoubanBoard.loadBooks("read");DoubanBoard.loadBooks("reading");DoubanBoard.loadBooks("wish");DoubanBoard.loadMovies();DoubanBoard.loadSingleBoard()},loadSingleBoard:function o(){if($(".douban-single").length<1)return;$.each($(".douban-single"),function(o,b){var a="";if($(b).attr("data-type")=="book"){a="/index.php/DoubanBoard?type=singlebook&id="+$(b).attr("data-id")}else{a="/index.php/DoubanBoard?type=singlemovie&id="+$(b).attr("data-id")}$.getJSON(a,function(o){var a=parseFloat($(b).attr("data-rating"));var n=o.title;var d=parseFloat(o.rating);var r=o.meta;var i=o.img;var e=o.url;var s=o.summary;var t=30*(5-Math.floor(d/2));if(d-Math.floor(d/2)*2>=1)t=t-15;var l=30*(5-Math.floor(a/2));if(a-Math.floor(a/2)*2>=1)l=l-15;var u='<div class="douban-single-img" style="background-image:url('+i+')"></div>\n                        <div class="douban-single-info">\n                            <a target="_blank" class="douban-single-title" href="'+e+'">'+n+'</a><br>\n                            <span class="douban-single-meta">'+r+'</span><br>\n                            豆瓣评分：<span class="douban-single-rating" style="background-position:0 -'+t+'px"></span> '+d+'<br>\n                            我的评分：<span class="douban-single-rating" style="background-position:0 -'+l+'px"></span> '+a+'<br>\n                            <span class="douban-single-summary">'+s+"</span>\n                        </div>";$(b).html(u)})})},loadBooks:function o(d){if($(".douban-book-list").length<1)return;$("#loadMoreBooks_"+d).html("加载中...");var r;if(d=="read")r=curBooks_read;else if(d=="reading")r=curBooks_reading;else r=curBooks_wish;var a=GLOBAL.homeSourceUrl+"/douban/douban.php?type=book&from="+String(r)+"&status="+d;$.getJSON(a,function(o){$("#loadMoreBooks_"+d).html("加载更多");if(o.length<DoubanPageSize){$("#loadMoreBooks_"+d).html("没有啦")}$.each(o,function(o,a){var n='<div id="doubanboard-book-item-'+String(r)+'" class="doubanboard-item">\n                            <div class="doubanboard-thumb" style="background-image:url('+a.img+')"></div>\n                            <div title="点击显示详情" class="doubanboard-title">'+a.title+'</div>\n                            <div class="doubanboard-info">\n                                <p class="doubanboard-info-basic">\n                                书名：'+a.title+"<br>\n                                评分："+a.rating+"<br>\n                                作者："+a.author+'<br>\n                                链接：<a target="_blank" href="'+a.link+'">豆瓣阅读</a><br>\n                                简介：<br>\n                                </p>\n                                <p class="doubanboard-info-summary">\n                                    '+a.summary+"\n                                </p>\n                            </div>\n                        </div>";$('.douban-book-list[data-status="'+d+'"]').append(n);if(d=="read")curBooks_read++;else if(d=="reading")curBooks_reading++;else curBooks_wish++})})},loadMovies:function o(){if($("#douban-movie-list").length<1)return;$("#loadMoreMovies").html("加载中...");$.getJSON(GLOBAL.homeSourceUrl+"/douban/douban.php?type=movie&from="+String(curMovies),function(o){$("#loadMoreMovies").html("加载更多");if(o.length<DoubanPageSize){$("#loadMoreMovies").html("没有啦")}$.each(o,function(o,a){if(a.name==""){return false}var n='<div id="doubanboard-movie-item-'+String(curMovies)+'" class="doubanboard-item" style="border: 2px solid;border-radius: 5px;-moz-border-radius:25px;">\n                            <div class="doubanboard-thumb" style="background-image:url('+a.img+')"></div>\n                            <div class="doubanboard-title"><a href="'+a.url+'" target="_blank">'+a.name+"</a></div>\n                        </div>";$("#douban-movie-list").append(n);curMovies++})})}};$(document).ready(function(){DoubanBoard.initDoubanBoard()});$(document).on("pjax:end",function(){DoubanBoard.initDoubanBoard()});$(document).click(function(o){var a=o.target;$(".doubanboard-item").removeClass("doubanboard-info-show");$(".doubanboard-item").each(function(){if($(a).parent()[0]==$(this)[0]||$(a)==$(this)[0]){$(this).addClass("doubanboard-info-show")}})});